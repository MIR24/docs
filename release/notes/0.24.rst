**********************************************
Релиз 0.24 (ST-984_) от 21.08.2019
**********************************************

Заметки по релизу. Список изменений:

.. _ST-984: https://mir24tv.atlassian.net/browse/ST-984

.. contents:: Содержание
   :depth: 2

Задача. MIRSCR-1194_
-----------------------------
Админка. Баннерные места. Исправлены заголовки для баннеров 31 и 32.


Баг. MIRSCR-902_
--------------------
Админка. Источники. Создание источника. Исправлена ошибка создания источника без указания типа.

Исправлена ошибка при которой создавая источник, указывая "Заголовок", но не указывая тип источника, созданный источник не отображался в интерфейсе.

Баг. MIRSCR-1056_
------------------------------
Исправлена ошибка, при которой не срабатывает скрипт медиатора на первой публикации.

Добавлен принудительный старт медиатора на первой статье. Принудительный старт вынесен в отдельную функцию которая выполняется сразу после загрузки страницы.

Добавлена задержка перед первым запуском медиатора.

Баг. MIRSCR-1093_
------------------------------
Исправлено кеширование ``/topics/actual.json``

Баг. MIRSCR-1109_
------------------------------
Админка. Сетка главной. Исправлена ошибка поиска публикации по полному наименованию.

Исправлена ошибка, при которой в модальном окне "Добавить новость/статью" в поле "Поиск", не осуществлялся поиск публикации по полному наименованию.


Баг. MIRSCR-1163_
------------------------------
Сайт. Просмотр новости. Исправлена ошибка при которой, прокручивая публикаций вниз не изменялся титул страницы.

Исправлена ошибка при которой прокручивая статью вниз, затем возвращая наверх титул страницы не восстанавливался.


История. MIRSCR-1160_
-----------------------
RSS. Фид wifi.rss. Произведена стандартизация фида wifi.rss_,  согласно требованиям и новым правилам.

Реализованы изменения в правилах формирования RSS фида wifi.rss_.


.. list-table:: Описание обязательных и опциональных элементов

    * - Элемент
      - Обязательный
      - Комментарии
    * - <?xml version="1.0" encoding="UTF-8"?>
      - да
      - Версия спецификации RSS. Ссылка в начале этого документа ведёт на описание этой спецификации
    * - <channel>
      - да
      - Допускается только один. Содержит информацию об источнике, а также набор элементов item.
    * - <title> (channel)
      - да
      - Название источника. Используется на клиентской части.
    * - <description> (channel)
      - да
      - Описание источника. Используется в системе управления контентом.
    * - <link> (channel)
      - да
      - Ссылка на источник (обычно имеется в виду ссылка на главную страницу). Используется на клиентской части.
    * - <lastBuildDate>
      - нет
      - Дата последней сборки фида в формате RFC822. Используется в системе управления контентом.
    * - <item>
      - да
      - Одна или несколько записей, представляющих материалы.
    * - <title> (item)
      - да
      - Заголовок материала. Допускается длина до 100 символов. Не допускается использование HTML-тэгов.
    * - <description> (item)
      - нет
      - Краткое описание материала. Не допускается использование HTML-тэгов.
    * - <link> (item)
      - да
      - Ссылка на материал в источнике. Используется на клиентской части. Является признаком уникальности материала. Допускается использование qwery-параметров, при этом сами материалы должны иметь уникальные пути. Например /search_article?id=1  и /search_article?id=2 как link для разных материалов недопустимы. По ссылке должен быть доступен опубликованный в источнике материал.
    * - <pubDate>
      - да
      - Время публикации материала (как в источнике) в формате RFC822. Используется на клиентской части.
    * - <author>
      - нет
      - Подпись под материалом. Используется на клиентской части. Не допускаются HTML-тэги или контактные данные. Имя, фамилия, отчество, псевдоним. Например: Петр "Пуля" Шалапин.
    * - <fullText>
      - да
      - HTML-фрагмент, представляющий из себя материал. Помещается в CDATA. Допустимые HTML-тэги: <p>, <a>, <b>, <i>, <ol>, <ul>, <li>, <figure>, <figcaption>, <img>, <iframe>. Допустимые атрибуты: В качестве схемы - https://. Общий принцип - последовательность параграфов, с помещёнными между ними по мере необходимости тэгами <figure>, <ol>, <ul>. Можно обратить внимание на пример, приведенный ниже. Отдельно про используемые изображения: Обязательно не менее 414px в ширину. Лучше 828px и более. Предпочтительные пропорции 16:9. Предпочтительные mime-типы: image/gif, image/jpeg, image/png, image/svg+xml
    * - <enclosure>
      - нет
      - Каждое используемое в материале изображение должно сопровождаться элементом enclosure, где url - ссылка на изображение, type - соответствующий изображению mime-тип. В случае отсутствия элемента cover первый элемент enclosure с одним из mime-типов image/png или image/jpeg будет использован в качестве обложки (обложка сопровождает заголовок материала на главной странице или странице рубрики). В случае отсутствия изображений в материале тэг является необязательным. В случае отсутствия enclosure с одним из mime-типов image/png или image/jpeg обложка будет отсутствовать.
    * - <cover>
      - нет
      - При наличии нескольких enclosure в item явно указывает какой из них использовать в качестве обложки. Должен являться копией одного из enclosure с mime-типом image/png или image/jpeg.
    * - <relatedLink>
      - нет
      - Если в источнике есть материалы по этой тематике, сообщите читателям об этом. Посредством этого элемента можно передать HTML-фрагмент, представляющий из себя тэг <a> с атрибутом href, являющийся ссылкой на один из материалов в источнике. Помещается в CDATA. Допустимое количество relatedLink в item - не более пяти.

Пример RSS с полным набором допустимых элементов.

.. code-block:: xml
   :linenos:

   <?xml version="1.0" encoding="UTF-8"?>
   <rss version="2.0">
    <channel>
     <title>Название источника</title>
     <description>Описание источника</description>
     <link>https://ssylka_na_glavnuu_stranicu_istochnika.ru</link>
     <lastBuildDate>Wed, 05 Jun 2019 12:54:36 +0300</lastBuildDate>
     <item>
      <title>Заголовок материала</title>
      <description>Краткое описание материала</description>
      <link>Ссылка на материал в источнике</link>
      <pubDate>Wed, 05 Jun 2019 12:50:00 +0300</pubDate>
      <author>petr_vasil@bestmailever.ru</author>
      <fullText><![CDATA[<p>Параграф текста статьи, предназначенный для размещения. Между параграфами можно использовать тэг img посредством тэга figure. Тэг figure не должен быть вложенным в параграф. Например:</p>
      <figure>
       <img src="https://images.ex.com/photo-1">
       <figcaption>Подпись к изображению, сведения об авторе</figcaption>
      </figure>
      <p>Для img допускаются атрибуты src и alt</p>
      <figure>
       <img src="https://images.ex.com/photo-2" alt="альтернативный текст">
       <figcaption>Подпись к изображению, сведения об авторе</figcaption>
      </figure>
       <p>Если изображение не будет обернуто тэгом figure с figcaption - мы не сможем красиво отрисовать подпись
       для него. Проследите, чтобы ресурс был доступен по https:// - схеме.</p>
       <p>Можно таким же образом использовать iframe. Допускаются атрибуты src или data-src</p>
      <figure>
        <iframe src="https://www.youtube.com/watch?v=9eP8PRiWgi4">iframe здесь</iframe>">
        <figcaption>Подпись</figcaption>
      </figure>
      <p>Если нужно использовать список, то можно также вставить его между параграфами:</p>
       <ul>
         <li>раз</li>
         <li>два</li>
         <li>три</li>
       </ul>
      <p>Можно использовать <b>жирный шрифт</b> или <i>курсив</i></p>
      <p>Тэги script и style не требуются - передавать их не стоит. Также не нужно оборачивать части материала в тэг div. Лучше придерживаться списка следующих тэгов: p, a, b, i, ol, ul, li, figure, img, iframe.</p>]]></fullText>
      <enclosure url="https://images.ex.com/photo-1" type="image/jpeg"/>
      <enclosure url="https://images.ex.com/photo-2" type="image/png"/>
      <cover url="https://images.ex.com/photo-2" type="image/png"/>
      <relatedLink><![CDATA[<a href="https://ssylka_na_glavnuu_stranicu_istochnika.ru/material2">Другая статья на эту тему в источнике</a>]]></relatedLink>
      <relatedLink><![CDATA[<a href="https://ssylka_na_glavnuu_stranicu_istochnika.ru/material3">Третья статья на похожую тему в источнике</a>]]></relatedLink>
     </item>
   </channel>
   </rss>



Общие рекомендации:

 * Сопровождать изменение в материале (title, description, fullText) изменением pubDate.

 * Придерживаться описанной выше механики работы с enclosure.

 * Использовать двойную кавычку (&quot;) для title, description, fullText. Остальные варианты мы постараемся привести к этому виду.

 * Не включать в fullText данные, для передачи которых используются отдельные элементы. Например, имя автора, название источника, дату публикации.

 * Не размещать в элементе fullText автоматически генерируемый динамический контент. Например, меняющиеся от запроса к запросу ссылки. В течение некоторого времени после публикации мы внимательно смотрим, не внесены ли изменения в материал, и имеем возможность обновить его после этого и у себя, сохранив предшествующую версию.

 * Не производить вставку HTML-тэга <img> вне тэга <figure>

 * Не передавать в fullText иные атрибуты html-тэгов кроме описанных. Но тем не менее, если это произойдет, мы постараемся поправитьэто на своей стороне.

 * Не передавать в fullText, enclosure, cover, relatedLink ссылки на недоступные ресурсы.

 * Не использовать CDATA для titlle и description. Нам нужен только текст.

 * Не передавать более трех элементов relatedLink - будут выбраны три случайных.

 * Не включать в ответ материалы, если после их публикации прошло более 7 дней. За это время они точно появятся у нас. При этом, как показывает практика, более "тяжёлые" ответы чаще испытывают проблемы с таймаутами, что может сделать их на какое-то время недоступными.



История. MIRSCR-753_
-----------------------
Админка. Интерфейс редактирования. Добавлена проверка скорости соединения с сервером.

Админка. Добавлена проверка скорости соединения с сервером. В случае если скорость соединения неудовлетворительная или соединение отсутствует, добавлен вывод сообщения: "Отсутствует соединение с сервером!" в админку.


История. MIRSCR-1079_
-------------------------
Сайт. Баннерные места. Созданы 2 новых баннерных места на страницах листингов ``/topic/{сюжет}``

Созданы 2 новых баннерные места на страницах_ листингов ``https://mir24.tv/topic/{сюжет}``:

.. image:: /images/topicbanners.jpg
   :width: 70 %



История. MIRSCR-1161_
-------------------------
Сайт. Баннерные места. Блок с публикациями "Тайны истории" заменен на баннерное место.

Удален блок содержащий публикации, с названием "Тайны истории" и заменен на баннерное место.

.. image:: /images/SiteBlockforBanner.png
   :width: 60 %





..
 MIRSCR-902

 История. MIRSCR-1160_
 ------------------------------------------


 RSS. Фид wifi.rss. Произведена стандартизация фида wifi.rss_,  согласно требованиям и новым правилам.

 Реализованы изменения в правилах формирования RSS фида wifi.rss_.

.. raw:: html

    <style media="screen">
        .figure img {
          box-shadow: #C3BBBB 3.5px 4px 4.4px 0.5px;
          margin-bottom: 7px;}
    </style>

..  _страницах: https://mir24.tv/topic/7887046
..  _wifi.rss: https://mir24.tv/export/wifi.rss
..	_MIRSCR-1194: https://mir24tv.atlassian.net/browse/MIRSCR-1194
..	_MIRSCR-1160: https://mir24tv.atlassian.net/browse/MIRSCR-1160
..	_MIRSCR-1056: https://mir24tv.atlassian.net/browse/MIRSCR-1056
..	_MIRSCR-1093: https://mir24tv.atlassian.net/browse/MIRSCR-1093
..	_MIRSCR-1109: https://mir24tv.atlassian.net/browse/MIRSCR-1109
..	_MIRSCR-1163: https://mir24tv.atlassian.net/browse/MIRSCR-1163
..	_MIRSCR-1161: https://mir24tv.atlassian.net/browse/MIRSCR-1161
..	_MIRSCR-1079: https://mir24tv.atlassian.net/browse/MIRSCR-1079
..	_MIRSCR-753: https://mir24tv.atlassian.net/browse/MIRSCR-753
..	_MIRSCR-902: https://mir24tv.atlassian.net/browse/MIRSCR-902
