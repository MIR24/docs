***********************************
Релиз 0.18 (ST-962_) от 01.07.2019
***********************************
Заметки по релизу. Список изменений:

.. _ST-962: https://mir24tv.atlassian.net/browse/ST-962

.. contents:: Содержание
   :depth: 2




`MIRSCR-1113 <https://mir24tv.atlassian.net/browse/MIRSCR-1113>`_
--------------------------------------------------------------------------
RSS. Yandex Turbo. Выполнена корректировка параметров публикуемых в "Турбо".

Выполнена корректировка параметров, для соответствия Турбо-страницы с оригиналом публикации.
Подобные исправления так же реализованы в связанной, с тематикой проблемы Yandex Turbo, задаче: `MIRSCR-934 <https://mir24tv.atlassian.net/browse/MIRSCR-934>`_.

`MIRSCR-1065 <https://mir24tv.atlassian.net/browse/MIRSCR-1065>`_
--------------------------------------------------------------------------
Backend-server. ``OKClient``. Устранена ошибка переполнения папки ``/tmp``.

При возникновении ошибок в работе с ``API Odnoklassniki``, происходило переполнение папки ``tmp``. Добавлена процедура очистки ``deleteTemp``.

`MIRSCR-1036 <https://mir24tv.atlassian.net/browse/MIRSCR-1036>`_
--------------------------------------------------------------------------
Сайт. Макеты разметки страниц.

Перенесена группа meta-тегов перенесены выше тега:
:code:`<script type="application/ld+json">...</script>`

.. code-block:: html
   :emphasize-lines: 3

   <meta name="..." content="..."  >
   <meta name="..." content="..." />
   <script type="application/ld+json">...</script>

`MIRSCR-1023 <https://mir24tv.atlassian.net/browse/MIRSCR-1023>`_
--------------------------------------------------------------------------
Админка. Публикация видео. Добавлено ограничение по типу загружаемого файла.

Исправлен функционал загрузки видео файлов, вызывающий  сообщения: "видео загружено" и "создаём плеер", при несоответствии загружаемого файла с типом видео файла.
Реализована проверка, для загрузки видео, тип видеофайла файла должен соответствовать: ``mp4``.

`MIRSCR-934 <https://mir24tv.atlassian.net/browse/MIRSCR-934>`_
--------------------------------------------------------------------------
Yandex Turbo. Исправлена проблема публикации видео на `Турбо-странице Яндекс <https://yandex.ru/turbo>`_.

Выполнена корректировка атрибутов и параметров публикуемых данных, для обеспечения соответствия условиям, необходимым для корректной публикаций видео в новости на Турбо-странице Яндекс. Подобные исправления так же реализованы в связанной, с тематикой проблемы Yandex Turbo, задаче: `MIRSCR-1113 <https://mir24tv.atlassian.net/browse/MIRSCR-1113>`_.

`MIRSCR-928 <https://mir24tv.atlassian.net/browse/MIRSCR-928>`_
--------------------------------------------------------------------------
Служебные контроллеры. Формирование страницы.
Исправлена ошибка, при которой в Мета-тег попадают запрещенные для использования символы.


`MIRSCR-911 <https://mir24tv.atlassian.net/browse/MIRSCR-911>`_
--------------------------------------------------------------------------
Админка. Публикация. Вставка кода в текст. Исправлена ошибка добавления 2-х ссылок встраиваемого видео imgur.com

Исправлена некорректная работа кода ``{}`` в тексте публикации. Устранена ошибка выполнения 2х сценариев встраиваемого видео imgur.com, при которой второе видео отображается в виде ссылки.


`MIRSCR-904 <https://mir24tv.atlassian.net/browse/MIRSCR-904>`_
--------------------------------------------------------------------------
Админка. Далет. Восстановлена работа страницы `editors.mir24.tv/dalet <https://editors.mir24.tv/dalet>`_

Исправлены критичные для открытия страницы ``/dalet``, ошибки в ``Dalet.js``


`MIRSCR-891 <https://mir24tv.atlassian.net/browse/MIRSCR-891>`_
--------------------------------------------------------------------------
Сайт. Страница новости. Исправлена ошибка отображения встраиваемого содержимого из Твиттера в публикации.

Исправлена некорректная работа стилей ``style.css``, при которой в тексте публикации, верхний блок (со СМИ ) перекрывал нижний блок содержимого из twitter.
Добавлен класс с отступом в ``style.css``:

.. code-block:: css

   .twitter-tweet{
    margin-top: 75px !important;
   }


`MIRSCR-877 <https://mir24tv.atlassian.net/browse/MIRSCR-877>`_
--------------------------------------------------------------------------
RSS. Яндекс.Видео. XML-фиды. ``Yandex video sitemap``.
Исправлена ошибка "Неизвестный тег ovs:video" в ``sitemap /yandex_video``:
`export/yandex_video/sitemap8.xml <https://mir24.tv/export/yandex_video/sitemap8.xml>`_

Указаны корректные заголовки:

.. code-block:: xml

   <urlset
    xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
    xmlns:ovs="http://video.yandex.ru/schemas/video_import">


`MIRSCR-890 <https://mir24tv.atlassian.net/browse/MIRSCR-890>`_
--------------------------------------------------------------------------
RSS. XML-фиды. Исправлена проблема кеширования ``XML-feed``-а Яндекс.Видео.

Устранена проблема, при которой ``yandex_video.xml`` не кешируется или кешируется в процессе ``HTTP`` запроса.
Во избежание ответа с ошибки 504, тяжелый запрос `mir24.tv/export/yandex_video.xml <http://mir24.tv/export/yandex_video.xml>`_, Кешируется методом CachePage.


`MIRSCR-860 <https://mir24tv.atlassian.net/browse/MIRSCR-860>`_
--------------------------------------------------------------------------
Форма обратной связи. Исправлена ошибка повторной отправки данных после прохождения капчи.

Исправлена проблема, вызывающая ошибку в работе страницы `feedback.html <https://mir24.tv/feedback.html>`_, связанная с расположением используемых файлов с ``cdn``.

При которой, заполняя форму обратной связи некорректными данными, получали сообщение: "Ошибка сохранения анкеты. Повторите попытку позже.". После повторного нажатия, "отправить", сообщение с ошибкой ``validation.captcha``.


`MIRSCR-859 <https://mir24tv.atlassian.net/browse/MIRSCR-859>`_
--------------------------------------------------------------------------
Администрирование. Деплой. Исправлена ошибка при которой разворачивание FS происходит некорректно и не открывается главная страница.

Исправлена логика деплоя, с использованием альтернативных команд, при которых ``backend-server`` не создаётся и не обрабатывается ситуация:

Символическая ссылка на папку с кропами в ``public/uploaded`` существует, но ``uploaded_path`` ссылается на несуществующую папку ``backend-server-а``.

`MIRSCR-844 <https://mir24tv.atlassian.net/browse/MIRSCR-844>`_
--------------------------------------------------------------------------
Админка. Исправлена ошибка при отмене создания новости в браузере firefox.

Исправлена проблема при которой используя браузер firefox, отмену создания новости по кнопке "Отменить", необходимо нажимать повторно.

`MIRSCR-835 <https://mir24tv.atlassian.net/browse/MIRSCR-835>`_
--------------------------------------------------------------------------
RSS. Исправлена проблема некорректного наименования видеофайлов, содержащих символы кириллицы.

Реализована генерация наименования видеофайла, публикуемого в ленту rss, исходя из времени загрузки: :code:`new Date().getTime()`


`MIRSCR-798 <https://mir24tv.atlassian.net/browse/MIRSCR-798>`_
--------------------------------------------------------------------------
Админка. Форма добавления программы. Реализован выпадающий список в поле "Возрастное ограничение".

На форме добавления новой программы, в поле "Возрастное ограничение", добавлена возможность выбора значения из выпадающего списка:

* 0+
* 6+
* 12+
* 16+
* 18+

`MIRSCR-733 <https://mir24tv.atlassian.net/browse/MIRSCR-733>`_
--------------------------------------------------------------------------
Сайт. Баннерные места. Реализована ротация подложки в баннерном месте.

В баннерном месте, при каждой загрузке страницы, подложка с кодом баннера выбирается случайным образом.


`MIRSCR-688 <https://mir24tv.atlassian.net/browse/MIRSCR-688>`_
--------------------------------------------------------------------------
RSS. Исправлена ошибка в представлении rss для Яндекс.Видео.


`MIRSCR-672 <https://mir24tv.atlassian.net/browse/MIRSCR-672>`_
--------------------------------------------------------------------------
Админка. Управление. Исправлены ошибки отображения корректных для роли пользователя, пунктов меню.

Произведена корректировка процедуры показа элементов меню, относительно прав доступа пользователя.

`MIRSCR-658 <https://mir24tv.atlassian.net/browse/MIRSCR-658>`_
--------------------------------------------------------------------------
Админка. Служебные. Источники. Устранена невозможность редактирования источника без заголовка.

Исправлена ошибка при которой невозможно редактировать источник, который не имеет Заголовка, Копирайта или origin

`MIRSCR-620 <https://mir24tv.atlassian.net/browse/MIRSCR-620>`_
--------------------------------------------------------------------------
Админка. Реализована лента всех опубликованных материалов.

Отображение страницы ленты происходит при переходе в административный интерфейс, переход осуществляется из пункта "Главная" в меню админки

Лента всех опубликованных материалов, расположена по адресу: https://editors.mir24.tv/all

`MIRSCR-686 <https://mir24tv.atlassian.net/browse/MIRSCR-686>`_
--------------------------------------------------------------------------
Сайт. Оптимизированы функциональные процедуры поиска по сайту.

Произведена оптимизация поиска с целью уменьшения вероятностей появления ошибок.

..
 `MIRSCR-1066 <https://mir24tv.atlassian.net/browse/MIRSCR-1066>`_
 --------------------------------------------------------------------------
 Исправлена сборка FS, при которой главная страница возвращает ошибку локально.

 Исправлена реализация кода для использования версии PHP 7.2, устранена ошибка:
 "Parameter must be an array or an object that implements Countable"

`MIRSCR-1094 <https://mir24tv.atlassian.net/browse/MIRSCR-1094>`_
--------------------------------------------------------------------------
Сайт. Мобильная версия. Убрано баннерное место №22.

`MIRSCR-1061 <https://mir24tv.atlassian.net/browse/MIRSCR-1061>`_
--------------------------------------------------------------------------
RSS. Исключены все сущности с тегом ``АНОНСЫ``

В список исключенных тегов из rss-фида добавлен тег: ``15354280 // АНОНСЫ``

.. code-block:: php
   :emphasize-lines: 9
   :linenos:

   <?php
   ...
   'excluded_by_tag' => [
   15348067,   // МИР24 ПРЕСС-РЕЛИЗЫ
   15348062,   // ЛИЦА МИРА
   15348023,   // МИР24 РЕКЛАМА
   15348024,   // МИР24 ВАКАНСИИ
   15348025,   // МИР24 КОНТАКТЫ
   15354280,   // АНОНСЫ
   ],];

`MIRSCR-1062 <https://mir24tv.atlassian.net/browse/MIRSCR-1062>`_
--------------------------------------------------------------------------
Сайт. Добавлен запрет на индексацию исключенной в `MIRSCR-1061 <https://mir24tv.atlassian.net/browse/MIRSCR-1061>`_ из rss сущности ``15354280 // АНОНСЫ``

Публикуемые материалы с тегом "Анонсы" содержат заголовок ``X-Robots-Tag:noindex``, исключая индексацию данных страниц.
