**********************************************
Релиз 0.23 (ST-992_) от 15.08.2019 (В работе)
**********************************************

Заметки по релизу. Список изменений:

.. _ST-992: https://mir24tv.atlassian.net/browse/ST-992


.. contents:: Содержание
   :depth: 2


Эпик. MIRSCR-1120_
------------------------------
Админка. Google Аналитика. Статистика просмотров. Реализован отчет о статистике просмотров по отдельным новостям. Отчет расположен в меню админки по кнопке: "Google аналитика".

Подробные сведения описаны в |ga| .

Реализация интерфейса
~~~~~~~~~~~~~~~~~~~~~~~~~~
Отчет расположен в меню админки по кнопке: "Google аналитика". Формирование отчета о статистике просмотров, включает:

 * Все материалы за произвольный день,
 * за последнюю неделю,
 * за последний месяц,
 * за последний квартал и последний год

Материалы группируются по entity_id, статистика берется из модели статистики если есть, если нет, запрашивается из Google.API.

 * Сортировка по кол-ву просмотров.

Отчет представлен в виде таблицы, где строка это:

 * "ссылки на материалы (Титулы, тип новость/статья)"
 * "дата публикации материала"
 * "Автор материала (создатель)"
 * "кол-во просмотров"
 * "кол-во уникальных просмотров"

Описание функционала
~~~~~~~~~~~~~~~~~~~~~~
Для накопления статистики и последующего использования ее в отчетах, статистика хранится по дням.

| Получив ответ от Google.API, ответ разбивается на дни и сохраняет 7 периодов.
| Что бы исключить постоянные обращения к Google.API *(количество обращений лимитировано)*, полученные от Google результаты необходимо сохранять в таблицу.
| Структура таблицы:

 * ID записи  (uint8,autoincrement)
 * entity_id  ( = entity_id news table)
 * url  (нужно для быстрого поиска по url)
 * from_datetime  (timestamp)
 * unique_views  (uint8)
 * total_views  (uint8)
 * complete  (true,false)

*Флаг complite ставится когда был запрос статистики за прошедший период, а значит он не может уже измениться.*

 * Время запроса статистики от 00:00 до 23:59 заданной даты;

 * В случае если статистика на запрошенный материал есть в таблице, то статистика рассчитывается из сохраненной таблицы.

 * Если статистика на запрошенный материал есть в сохраненной таблице, но период не закрыт, то:

      * Статистику запрашивали меньше пяти минут назад - расчет из сохраненной таблицы;
      * Иначе выполняется запрос от Google.API и сохраняется в таблице.

 * Если статистика отсутствует и она за **прошлый** период, то выполняется запрос от Google.API и сохраняется с флагом complete = ``true``;
 * Если статистика отсутствует и она за **текущий** период, то необходимо выполняется запрос от Google.API и сохраняется с флагом complete = ``false``.

.. |ga| replace:: :ref:`Статистика просмотров новостей в админке <google-analytics>`

..	_MIRSCR-1122: https://mir24tv.atlassian.net/browse/MIRSCR-1120
